{% comment %}
  3D Product Showcase Section
  Full-width section with customizable products and Three.js animation
{% endcomment %}

<style>
  .product-showcase-{{ section.id }} {
    position: relative;
    width: 100%;
    min-height: 600px;
    background: #000;
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    overflow: hidden;
  }

  .product-showcase-{{ section.id }} canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .product-info {
    position: absolute;
    color: white;
    z-index: 10;
    max-width: 300px;
  }

  .product-info h3 {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
    font-family: system-ui, -apple-system, sans-serif;
  }

  .product-info p {
    font-size: 14px;
    line-height: 1.6;
    opacity: 0.9;
    font-family: system-ui, -apple-system, sans-serif;
  }

  .product-info img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 50%;
    margin-bottom: 15px;
    border: 2px solid rgba(255, 255, 255, 0.3);
  }

  .product-info-1 img,
  .product-info-2 img,
  .product-info-3 img {
    display: block;
  }

  .product-info-1 img {
    margin-left: auto;
  }

  .product-info::before {
    content: '';
    position: absolute;
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
  }

  .product-info-1 {
    top: 20%;
    left: 10%;
    text-align: right;
  }

  .product-info-1::before {
    right: -60px;
    top: 10px;
  }

  .product-info-2 {
    top: 15%;
    right: 10%;
    text-align: left;
  }

  .product-info-2::before {
    left: -60px;
    top: 10px;
  }

  .product-info-3 {
    bottom: 20%;
    right: 10%;
    text-align: left;
  }

  .product-info-3::before {
    left: -60px;
    top: 10px;
  }

  @media (max-width: 768px) {
    .product-showcase-{{ section.id }} {
      min-height: 500px;
    }

    .product-info {
      max-width: 200px;
    }

    .product-info h3 {
      font-size: 18px;
    }

    .product-info p {
      font-size: 12px;
    }
  }
</style>

<div class="product-showcase-{{ section.id }}">
  <canvas id="canvas-{{ section.id }}"></canvas>
  
  {% if section.settings.product_1_title != blank %}
  <div class="product-info product-info-1">
    <h3>{{ section.settings.product_1_title }}</h3>
    <p>{{ section.settings.product_1_description }}</p>
  </div>
  {% endif %}

  {% if section.settings.product_2_title != blank %}
  <div class="product-info product-info-2">
    <h3>{{ section.settings.product_2_title }}</h3>
    <p>{{ section.settings.product_2_description }}</p>
  </div>
  {% endif %}

  {% if section.settings.product_3_title != blank %}
  <div class="product-info product-info-3">
    <h3>{{ section.settings.product_3_title }}</h3>
    <p>{{ section.settings.product_3_description }}</p>
  </div>
  {% endif %}
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
(function() {
  const container = document.querySelector('.product-showcase-{{ section.id }}');
  const canvas = document.getElementById('canvas-{{ section.id }}');
  
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, container.offsetWidth / container.offsetHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
  
  renderer.setSize(container.offsetWidth, container.offsetHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  
  // Central sphere
  const sphereGeometry = new THREE.SphereGeometry(1, 32, 32);
  const sphereMaterial = new THREE.MeshStandardMaterial({
    color: 0xcccccc,
    metalness: 0.8,
    roughness: 0.2
  });
  const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
  scene.add(sphere);
  
  // Rings around sphere
  const ringGeometry = new THREE.TorusGeometry(1.2, 0.05, 16, 100);
  const ringMaterial = new THREE.MeshStandardMaterial({
    color: 0x666666,
    metalness: 0.7,
    roughness: 0.3
  });
  
  for (let i = 0; i < 5; i++) {
    const ring = new THREE.Mesh(ringGeometry, ringMaterial);
    ring.rotation.x = Math.PI / 2 + (i * 0.2);
    ring.rotation.y = i * 0.3;
    sphere.add(ring);
  }
  
  // Flowing lines
  const linePoints = [];
  const numLines = 3;
  const lines = [];
  
  for (let i = 0; i < numLines; i++) {
    const points = [];
    for (let j = 0; j < 100; j++) {
      const angle = (j / 100) * Math.PI * 2;
      const radius = 3 + Math.sin(j * 0.1) * 0.5;
      const x = Math.cos(angle + i * 2) * radius;
      const y = Math.sin(angle * 2 + i) * 0.5;
      const z = Math.sin(angle + i * 2) * radius;
      points.push(new THREE.Vector3(x, y, z));
    }
    
    const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
    const lineMaterial = new THREE.LineBasicMaterial({
      color: 0x444444,
      transparent: true,
      opacity: 0.6
    });
    const line = new THREE.Line(lineGeometry, lineMaterial);
    scene.add(line);
    lines.push(line);
  }
  
  // Lights
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
  scene.add(ambientLight);
  
  const pointLight1 = new THREE.PointLight(0xffffff, 1, 100);
  pointLight1.position.set(5, 5, 5);
  scene.add(pointLight1);
  
  const pointLight2 = new THREE.PointLight(0xffffff, 0.5, 100);
  pointLight2.position.set(-5, -5, -5);
  scene.add(pointLight2);
  
  camera.position.z = 6;
  
  // Animation
  function animate() {
    requestAnimationFrame(animate);
    
    sphere.rotation.y += 0.003;
    sphere.rotation.x += 0.001;
    
    lines.forEach((line, index) => {
      line.rotation.y += 0.002 * (index + 1);
      line.rotation.x += 0.001 * (index + 1);
    });
    
    renderer.render(scene, camera);
  }
  
  animate();
  
  // Handle resize
  window.addEventListener('resize', function() {
    camera.aspect = container.offsetWidth / container.offsetHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.offsetWidth, container.offsetHeight);
  });
})();
</script>

{% schema %}
{
  "name": "3D Product Showcase",
  "settings": [
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Top Padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 60
    },
    {
      "type": "header",
      "content": "Product 1 (Top Left)"
    },
    {
      "type": "text",
      "id": "product_1_title",
      "label": "Title",
      "default": "Product Name"
    },
    {
      "type": "textarea",
      "id": "product_1_description",
      "label": "Description",
      "default": "Lorem ipsum dolor sit amet consectetur. Nulla habitant accumsan commodo porttitor. Enim malesuada."
    },
    {
      "type": "header",
      "content": "Product 2 (Top Right)"
    },
    {
      "type": "text",
      "id": "product_2_title",
      "label": "Title",
      "default": "Product Name"
    },
    {
      "type": "textarea",
      "id": "product_2_description",
      "label": "Description",
      "default": "Lorem ipsum dolor sit amet consectetur. Nulla habitant accumsan commodo porttitor. Enim malesuada."
    },
    {
      "type": "header",
      "content": "Product 3 (Bottom Right)"
    },
    {
      "type": "text",
      "id": "product_3_title",
      "label": "Title",
      "default": "Product Name"
    },
    {
      "type": "textarea",
      "id": "product_3_description",
      "label": "Description",
      "default": "Lorem ipsum dolor sit amet consectetur. Nulla habitant accumsan commodo porttitor. Enim malesuada."
    }
  ],
  "presets": [
    {
      "name": "3D Product Showcase"
    }
  ]
}
{% endschema %}