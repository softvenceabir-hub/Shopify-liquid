{% doc %}
  @prompt
    'use client';
    import { ReactLenis } from 'lenis/react';
    import { useTransform, motion, useScroll } from 'motion/react';
    import { useRef } from 'react';
    import Image from 'next/image';
    const projects = [
      {
        title: 'Matthias Leidinger',
        description:
          'Originally hailing from Austria, Berlin-based photographer Matthias Leindinger is a young creative brimming with talent and ideas.',
        src: 'rock.jpg',
        link: 'https://images.unsplash.com/photo-1605106702842-01a887a31122?q=80&w=500&auto=format&fit=crop',
        color: '#5196fd',
      },
      {
        title: 'Clément Chapillon',
        description:
          'This is a story on the border between reality and imaginary, about the contradictory feelings that the insularity of a rocky, arid, and wild territory provokes”—so French photographer Clément.',
        src: 'tree.jpg',
        link: 'https://images.unsplash.com/photo-1605106250963-ffda6d2a4b32?w=500&auto=format&fit=crop&q=60',
        color: '#8f89ff',
      },
      {
        title: 'Zissou',
        description:
          'Though he views photography as a medium for storytelling, Zissou’s images don’t insist on a narrative. Both crisp and ethereal.',
        src: 'water.jpg',
        link: 'https://images.unsplash.com/photo-1605106901227-991bd663255c?w=500&auto=format&fit=crop',
        color: '#13006c',
      },
      {
        title: 'Mathias Svold and Ulrik Hasemann',
        description:
          'The coastlines of Denmark are documented in tonal colors in a pensive new series by Danish photographers Ulrik Hasemann and Mathias Svold; an ongoing project investigating how humans interact with and disrupt the Danish coast.',
        src: 'house.jpg',
        link: 'https://images.unsplash.com/photo-1605106715994-18d3fecffb98?w=500&auto=format&fit=crop&q=60',
        color: '#ed649e',
      },
      {
        title: 'Mark Rammers',
        description:
          'Dutch photographer Mark Rammers has shared with IGNANT the first chapter of his latest photographic project, ‘all over again’—captured while in residency at Hektor, an old farm in Los Valles, Lanza
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-parallax-gallery-{{ ai_gen_id }} {
    width: 100%;
    background-color: {{ block.settings.background_color }};
    padding: {{ block.settings.section_padding }}px 0;
  }

  .ai-parallax-gallery-container-{{ ai_gen_id }} {
    max-width: {{ block.settings.container_width }}px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ai-parallax-gallery-item-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: {{ block.settings.item_gap }}px;
    margin-bottom: {{ block.settings.item_spacing }}px;
    opacity: 0;
    transform: translateY(50px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .ai-parallax-gallery-item-{{ ai_gen_id }}.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .ai-parallax-gallery-item-{{ ai_gen_id }}:nth-child(even) {
    flex-direction: row-reverse;
  }

  .ai-parallax-gallery-image-wrapper-{{ ai_gen_id }} {
    flex: 0 0 50%;
    position: relative;
    overflow: hidden;
    border-radius: {{ block.settings.image_border_radius }}px;
    height: {{ block.settings.image_height }}px;
  }

  .ai-parallax-gallery-image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    will-change: transform;
  }

  .ai-parallax-gallery-content-{{ ai_gen_id }} {
    flex: 0 0 50%;
    padding: 20px;
  }

  .ai-parallax-gallery-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    font-weight: 700;
    color: {{ block.settings.text_color }};
    margin: 0 0 15px 0;
    line-height: 1.2;
  }

  .ai-parallax-gallery-description-{{ ai_gen_id }} {
    font-size: {{ block.settings.description_size }}px;
    color: {{ block.settings.text_color }};
    line-height: 1.6;
    margin: 0;
    opacity: 0.85;
  }

  .ai-parallax-gallery-link-{{ ai_gen_id }} {
    display: inline-block;
    margin-top: 20px;
    padding: 12px 24px;
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    text-decoration: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: 14px;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }

  .ai-parallax-gallery-link-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_color }};
  }

  @media screen and (max-width: 768px) {
    .ai-parallax-gallery-item-{{ ai_gen_id }},
    .ai-parallax-gallery-item-{{ ai_gen_id }}:nth-child(even) {
      flex-direction: column;
    }

    .ai-parallax-gallery-image-wrapper-{{ ai_gen_id }},
    .ai-parallax-gallery-content-{{ ai_gen_id }} {
      flex: 0 0 100%;
    }

    .ai-parallax-gallery-image-wrapper-{{ ai_gen_id }} {
      height: 300px;
    }

    .ai-parallax-gallery-title-{{ ai_gen_id }} {
      font-size: {{ block.settings.title_size | times: 0.8 }}px;
    }

    .ai-parallax-gallery-description-{{ ai_gen_id }} {
      font-size: {{ block.settings.description_size | times: 0.9 }}px;
    }
  }
{% endstyle %}

<parallax-gallery-{{ ai_gen_id }} class="ai-parallax-gallery-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-parallax-gallery-container-{{ ai_gen_id }}">
    {% for i in (1..5) %}
      {% liquid
        assign title_key = 'item_' | append: i | append: '_title'
        assign description_key = 'item_' | append: i | append: '_description'
        assign image_key = 'item_' | append: i | append: '_image'
        assign link_key = 'item_' | append: i | append: '_link'
        assign link_text_key = 'item_' | append: i | append: '_link_text'
        
        assign title = block.settings[title_key]
        assign description = block.settings[description_key]
        assign image = block.settings[image_key]
        assign link = block.settings[link_key]
        assign link_text = block.settings[link_text_key]
      %}

      <div class="ai-parallax-gallery-item-{{ ai_gen_id }}" data-index="{{ i }}">
        <div class="ai-parallax-gallery-image-wrapper-{{ ai_gen_id }}">
          {% if image %}
            <img
              src="{{ image | image_url: width: 1000 }}"
              alt="{{ title | escape }}"
              class="ai-parallax-gallery-image-{{ ai_gen_id }}"
              loading="lazy"
              width="1000"
              height="{{ block.settings.image_height }}"
            >
          {% else %}
            <div class="ai-parallax-gallery-image-placeholder-{{ ai_gen_id }}">
              {{ 'image' | placeholder_svg_tag }}
            </div>
          {% endif %}
        </div>

        <div class="ai-parallax-gallery-content-{{ ai_gen_id }}">
          {% if title != blank %}
            <h3 class="ai-parallax-gallery-title-{{ ai_gen_id }}">{{ title }}</h3>
          {% endif %}
          
          {% if description != blank %}
            <p class="ai-parallax-gallery-description-{{ ai_gen_id }}">{{ description }}</p>
          {% endif %}

          {% if link != blank and link_text != blank %}
            <a href="{{ link }}" class="ai-parallax-gallery-link-{{ ai_gen_id }}">
              {{ link_text }}
            </a>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
</parallax-gallery-{{ ai_gen_id }}>

<script>
  (function() {
    class ParallaxGallery{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.items = [];
        this.images = [];
        this.scrollHandler = this.handleScroll.bind(this);
        this.resizeHandler = this.handleResize.bind(this);
      }

      connectedCallback() {
        this.items = Array.from(this.querySelectorAll('.ai-parallax-gallery-item-{{ ai_gen_id }}'));
        this.images = Array.from(this.querySelectorAll('.ai-parallax-gallery-image-{{ ai_gen_id }}'));
        
        this.setupObserver();
        this.setupScrollListener();
        this.handleScroll();
      }

      setupObserver() {
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
            }
          });
        }, observerOptions);

        this.items.forEach(item => observer.observe(item));
      }

      setupScrollListener() {
        let ticking = false;

        window.addEventListener('scroll', () => {
          if (!ticking) {
            window.requestAnimationFrame(() => {
              this.scrollHandler();
              ticking = false;
            });
            ticking = true;
          }
        });

        window.addEventListener('resize', this.resizeHandler);
      }

      handleScroll() {
        const scrollY = window.pageYOffset;
        const windowHeight = window.innerHeight;

        this.images.forEach((image, index) => {
          const item = this.items[index];
          if (!item) return;

          const rect = item.getBoundingClientRect();
          const itemTop = rect.top + scrollY;
          const itemHeight = rect.height;

          if (rect.top < windowHeight && rect.bottom > 0) {
            const scrollProgress = (scrollY + windowHeight - itemTop) / (windowHeight + itemHeight);
            const clampedProgress = Math.max(0, Math.min(1, scrollProgress));
            
            const parallaxAmount = {{ block.settings.parallax_strength }};
            const translateY = (clampedProgress - 0.5) * parallaxAmount;
            
            image.style.transform = `translateY(${translateY}px) scale(1.1)`;
          }
        });
      }

      handleResize() {
        this.handleScroll();
      }

      disconnectedCallback() {
        window.removeEventListener('scroll', this.scrollHandler);
        window.removeEventListener('resize', this.resizeHandler);
      }
    }

    customElements.define('parallax-gallery-{{ ai_gen_id }}', ParallaxGallery{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Parallax gallery",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 800,
      "max": 1600,
      "step": 100,
      "unit": "px",
      "label": "Container width",
      "default": 1200
    },
    {
      "type": "range",
      "id": "section_padding",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Section padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "item_spacing",
      "min": 20,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Item spacing",
      "default": 100
    },
    {
      "type": "range",
      "id": "item_gap",
      "min": 20,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Content gap",
      "default": 60
    },
    {
      "type": "header",
      "content": "Image"
    },
    {
      "type": "range",
      "id": "image_height",
      "min": 300,
      "max": 700,
      "step": 50,
      "unit": "px",
      "label": "Image height",
      "default": 500
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Image border radius",
      "default": 12
    },
    {
      "type": "range",
      "id": "parallax_strength",
      "min": 0,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Parallax strength",
      "default": 100
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button background",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "Button hover background",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 32
    },
    {
      "type": "range",
      "id": "description_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Description size",
      "default": 16
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Button border radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Item 1"
    },
    {
      "type": "text",
      "id": "item_1_title",
      "label": "Title",
      "default": "Matthias Leidinger"
    },
    {
      "type": "textarea",
      "id": "item_1_description",
      "label": "Description",
      "default": "Originally hailing from Austria, Berlin-based photographer Matthias Leindinger is a young creative brimming with talent and ideas."
    },
    {
      "type": "image_picker",
      "id": "item_1_image",
      "label": "Image"
    },
    {
      "type": "url",
      "id": "item_1_link",
      "label": "Link"
    },
    {
      "type": "text",
      "id": "item_1_link_text",
      "label": "Link text",
      "default": "View project"
    },
    {
      "type": "header",
      "content": "Item 2"
    },
    {
      "type": "text",
      "id": "item_2_title",
      "label": "Title",
      "default": "Clément Chapillon"
    },
    {
      "type": "textarea",
      "id": "item_2_description",
      "label": "Description",
      "default": "This is a story on the border between reality and imaginary, about the contradictory feelings that the insularity of a rocky, arid, and wild territory provokes."
    },
    {
      "type": "image_picker",
      "id": "item_2_image",
      "label": "Image"
    },
    {
      "type": "url",
      "id": "item_2_link",
      "label": "Link"
    },
    {
      "type": "text",
      "id": "item_2_link_text",
      "label": "Link text",
      "default": "View project"
    },
    {
      "type": "header",
      "content": "Item 3"
    },
    {
      "type": "text",
      "id": "item_3_title",
      "label": "Title",
      "default": "Zissou"
    },
    {
      "type": "textarea",
      "id": "item_3_description",
      "label": "Description",
      "default": "Though he views photography as a medium for storytelling, Zissou's images don't insist on a narrative. Both crisp and ethereal."
    },
    {
      "type": "image_picker",
      "id": "item_3_image",
      "label": "Image"
    },
    {
      "type": "url",
      "id": "item_3_link",
      "label": "Link"
    },
    {
      "type": "text",
      "id": "item_3_link_text",
      "label": "Link text",
      "default": "View project"
    },
    {
      "type": "header",
      "content": "Item 4"
    },
    {
      "type": "text",
      "id": "item_4_title",
      "label": "Title",
      "default": "Mathias Svold and Ulrik Hasemann"
    },
    {
      "type": "textarea",
      "id": "item_4_description",
      "label": "Description",
      "default": "The coastlines of Denmark are documented in tonal colors in a pensive new series by Danish photographers."
    },
    {
      "type": "image_picker",
      "id": "item_4_image",
      "label": "Image"
    },
    {
      "type": "url",
      "id": "item_4_link",
      "label": "Link"
    },
    {
      "type": "text",
      "id": "item_4_link_text",
      "label": "Link text",
      "default": "View project"
    },
    {
      "type": "header",
      "content": "Item 5"
    },
    {
      "type": "text",
      "id": "item_5_title",
      "label": "Title",
      "default": "Mark Rammers"
    },
    {
      "type": "textarea",
      "id": "item_5_description",
      "label": "Description",
      "default": "Dutch photographer Mark Rammers has shared the first chapter of his latest photographic project, captured while in residency at Hektor."
    },
    {
      "type": "image_picker",
      "id": "item_5_image",
      "label": "Image"
    },
    {
      "type": "url",
      "id": "item_5_link",
      "label": "Link"
    },
    {
      "type": "text",
      "id": "item_5_link_text",
      "label": "Link text",
      "default": "View project"
    }
  ],
  "presets": [
    {
      "name": "Parallax gallery"
    }
  ]
}
{% endschema %}
